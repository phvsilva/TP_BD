-- CRIAR TABELAS
CREATE TABLE codigoPostal (
    cPostal VARCHAR(8) NOT NULL,
    localidade VARCHAR(25) NOT NULL,
    PRIMARY KEY (cPostal)
);

CREATE TABLE Modo_Pagamento (
    id_ModoPag INTEGER NOT NULL,
    descricao VARCHAR(50) NOT NULL,
    PRIMARY KEY (id_ModoPag)
);

CREATE TABLE TipoSala (
    id_tipo INTEGER NOT NULL,
    descricao VARCHAR(50) NOT NULL,
    PRIMARY KEY (id_tipo)
);

CREATE TABLE Salas (
    id_sala INTEGER NOT NULL,
    id_tipo INTEGER NOT NULL,
    PRIMARY KEY (id_sala)
);

CREATE TABLE TipoCurso (
    id_tipo INTEGER NOT NULL,
    descricao VARCHAR(50) NOT NULL,
    PRIMARY KEY (id_tipo)
);

CREATE TABLE Curso (
    id_Curso INTEGER NOT NULL,
    Sigla VARCHAR(6) NOT NULL,
    nome VARCHAR(50) NOT NULL,
    id_tipo INTEGER NOT NULL,
    PRIMARY KEY (id_Curso)
);

CREATE TABLE Disciplina (
    id_Disciplina INTEGER NOT NULL,
    sigla VARCHAR(4) NOT NULL,
    descricao VARCHAR(50) NOT NULL,
    PRIMARY KEY (id_Disciplina)
);

CREATE TABLE Professor (
    id_Professor INTEGER NOT NULL,
    nome VARCHAR(50) NOT NULL,
    rua VARCHAR(50) NOT NULL,
    nPorta INTEGER NOT NULL,
    cPostal VARCHAR(8) NOT NULL,
    telefone INTEGER NOT NULL,
    email VARCHAR(50) NOT NULL,
    NIF INTEGER NOT NULL,
    PRIMARY KEY (id_Professor)
);

CREATE TABLE Professor_Disciplina (
    id_Disciplina INTEGER NOT NULL,
    id_professor INTEGER NOT NULL,
    PRIMARY KEY (id_Disciplina, id_professor)
);

CREATE TABLE Aluno (
    num_Aluno INTEGER NOT NULL,
    nome VARCHAR(50) NOT NULL,
    data_nascimento DATE NOT NULL,
    id_curso INTEGER NOT NULL,
    rua VARCHAR(50) NOT NULL,
    nPorta INTEGER NOT NULL,
    cPostal VARCHAR(8) NOT NULL,
    telefone INTEGER NOT NULL,
    email VARCHAR(50) NOT NULL,
    NIF INTEGER NOT NULL,
    PRIMARY KEY (num_Aluno)
);

CREATE TABLE Sessao (
    num_Sessao INTEGER NOT NULL,
    data DATE NOT NULL,
    hora_fim VARCHAR(5) NOT NULL,
    hora_inicio VARCHAR(5) NOT NULL,
    id_disciplina INTEGER NOT NULL,
    id_Professor INTEGER NOT NULL,
    id_sala INTEGER NOT NULL,
    PRIMARY KEY (num_Sessao)
);

CREATE TABLE Aluno_Sessao (
    num_Aluno INTEGER NOT NULL,
    num_Sessao INTEGER NOT NULL,
    PRIMARY KEY (num_Aluno, num_Sessao)
);

CREATE TABLE Pagamento (
    num_pagamento INTEGER NOT NULL,
    valor_total NUMERIC(5,2) NOT NULL,
    data_pagamento DATE NOT NULL,
    num_Aluno INTEGER NOT NULL,
    id_ModoPag INTEGER NOT NULL,
    PRIMARY KEY (num_pagamento)
);

CREATE TABLE Pagamento_Sessao (
    num_pagamento INTEGER NOT NULL,
    num_sessao INTEGER NOT NULL,
    PRIMARY KEY (num_pagamento, num_sessao)
);

-- DEFINIR CHAVES ESTRANGEIRAS (RESTRIÇÕES DE INTEGRIDADE)

ALTER TABLE Salas ADD FOREIGN KEY (id_tipo) REFERENCES TipoSala(id_tipo);
ALTER TABLE Curso ADD FOREIGN KEY (id_tipo) REFERENCES TipoCurso(id_tipo);
ALTER TABLE Professor ADD FOREIGN KEY (cPostal) REFERENCES codigoPostal(cPostal);
ALTER TABLE Professor_Disciplina ADD FOREIGN KEY (id_professor) REFERENCES Professor(id_Professor);
ALTER TABLE Professor_Disciplina ADD FOREIGN KEY (id_Disciplina) REFERENCES Disciplina(id_Disciplina);
ALTER TABLE Aluno ADD FOREIGN KEY (id_curso) REFERENCES Curso(id_Curso);
ALTER TABLE Aluno ADD FOREIGN KEY (cPostal) REFERENCES codigoPostal(cPostal);
ALTER TABLE Sessao ADD FOREIGN KEY (id_Professor) REFERENCES Professor(id_Professor);
ALTER TABLE Sessao ADD FOREIGN KEY (id_disciplina) REFERENCES Disciplina(id_Disciplina);
ALTER TABLE Sessao ADD FOREIGN KEY (id_sala) REFERENCES Salas(id_sala);
ALTER TABLE Aluno_Sessao ADD FOREIGN KEY (num_Aluno) REFERENCES Aluno(num_Aluno);
ALTER TABLE Aluno_Sessao ADD FOREIGN KEY (num_Sessao) REFERENCES Sessao(num_Sessao);
ALTER TABLE Pagamento ADD FOREIGN KEY (num_Aluno) REFERENCES Aluno(num_Aluno);
ALTER TABLE Pagamento ADD FOREIGN KEY (id_ModoPag) REFERENCES Modo_Pagamento(id_ModoPag);
ALTER TABLE Pagamento_Sessao ADD FOREIGN KEY (num_sessao) REFERENCES Sessao(num_Sessao);
ALTER TABLE Pagamento_Sessao ADD FOREIGN KEY (num_pagamento) REFERENCES Pagamento(num_pagamento);

-- INSERIR DADOS EM ALGUMAS TABELAS PARA TESTAR

-- INSERT CODIGOS POSTAIS
INSERT INTO CODIGOPOSTAL(CPOSTAL, LOCALIDADE) VALUES('4970-555','SÃO COSME E SÃO DAMIÃO');
INSERT INTO CODIGOPOSTAL(CPOSTAL, LOCALIDADE) VALUES('4970-441','PRAÇA MUNICIPAL');
INSERT INTO CODIGOPOSTAL(CPOSTAL, LOCALIDADE) VALUES('4900-357','RUA SANTIAGO DA BARRA');

-- INSERT TIPOS DE CURSO
INSERT INTO TIPOCURSO(ID_TIPO, DESCRICAO) VALUES(1,'CURSO PROFISSIONAL');
INSERT INTO TIPOCURSO(ID_TIPO, DESCRICAO) VALUES(2,'LICENCIATURA');
INSERT INTO TIPOCURSO(ID_TIPO, DESCRICAO) VALUES(3,'MESTRADO');
INSERT INTO TIPOCURSO(ID_TIPO, DESCRICAO) VALUES(4,'DOUTORAMENTO');

-- INSERT CURSOS
INSERT INTO CURSO(ID_CURSO, SIGLA, NOME, ID_TIPO) VALUES(9119,'EI','ENGENHARIA INFORMATICA',2);
INSERT INTO CURSO(ID_CURSO, SIGLA, NOME, ID_TIPO) VALUES(9147,'G','GESTÃO',2);
INSERT INTO CURSO(ID_CURSO, SIGLA, NOME, ID_TIPO) VALUES(6797,'MTGSI','MESTRADO TEC. E GESTÃO SISTEMAS DE INFORMAÇÃO',3);
INSERT INTO CURSO(ID_CURSO, SIGLA, NOME, ID_TIPO) VALUES(067,'CTSPIG','CTSP DE INFORMATICA DE GESTÃO',1);
INSERT INTO CURSO(ID_CURSO, SIGLA, NOME, ID_TIPO) VALUES(5141,'DEI','DOUTORAMENTO ENGENHARIA INFORMATICA',4);

-- INSERT TIPOSALA
INSERT INTO TIPOSALA(ID_TIPO, DESCRICAO) VALUES(1,'SALA');
INSERT INTO TIPOSALA(ID_TIPO, DESCRICAO) VALUES(2,'LABORATORIO');
INSERT INTO TIPOSALA(ID_TIPO, DESCRICAO) VALUES(3,'AUDITORIO');

-- INSERT SALAS
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(1,1);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(2,1);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(3,1);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(4,1);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(5,1);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(6,2);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(7,2);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(8,2);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(9,3);
INSERT INTO SALAS(ID_SALA, ID_TIPO) VALUES(10,3);

-- INSERT DISCIPLINAS
INSERT INTO DISCIPLINA(ID_DISCIPLINA, SIGLA, DESCRICAO) VALUES(1,'BD','BASE DE DADOS');
INSERT INTO DISCIPLINA(ID_DISCIPLINA, SIGLA, DESCRICAO) VALUES(2,'ASC','ARQUITETURA E SISTEMAS DE COMPUTADORES');
INSERT INTO DISCIPLINA(ID_DISCIPLINA, SIGLA, DESCRICAO) VALUES(3,'IHM','INTERAÇÃO HOMEM-MAQUINA');
INSERT INTO DISCIPLINA(ID_DISCIPLINA, SIGLA, DESCRICAO) VALUES(4,'IA','INTELIGENCIA ARTIFICIAL');
INSERT INTO DISCIPLINA(ID_DISCIPLINA, SIGLA, DESCRICAO) VALUES(5,'ABD','ADMINISTRAÇÃO DE BASE DE DADOS');

-- INSERT PROFESSORES
INSERT INTO PROFESSOR(ID_PROFESSOR, NOME, RUA, NPORTA, CPOSTAL, TELEFONE, EMAIL, NIF)
VALUES(1,'VASCO SILVA','RUA SANTIAGO DA BARRA',17,'4900-357',965789987,'vascosilva@ipvc.pt',123456789);
INSERT INTO PROFESSOR(ID_PROFESSOR, NOME, RUA, NPORTA, CPOSTAL, TELEFONE, EMAIL, NIF)
VALUES(2,'ANA MIRANDA','CASTANHEIRA',54,'4970-555',912343211,'mirandaana@ipvc.pt',987654321);
INSERT INTO PROFESSOR(ID_PROFESSOR, NOME, RUA, NPORTA, CPOSTAL, TELEFONE, EMAIL, NIF)
VALUES(3,'ANTONIO ALVES','RUA DA LIBERDADE',7,'4970-441',933444555,'a.alves@ipvc.pt',543219876);

-- INSERT PROFESSOR_DISCIPLINA
INSERT INTO PROFESSOR_DISCIPLINA(ID_DISCIPLINA, ID_PROFESSOR) VALUES(1,3);
INSERT INTO PROFESSOR_DISCIPLINA(ID_DISCIPLINA, ID_PROFESSOR) VALUES(2,1);
INSERT INTO PROFESSOR_DISCIPLINA(ID_DISCIPLINA, ID_PROFESSOR) VALUES(3,2);
INSERT INTO PROFESSOR_DISCIPLINA(ID_DISCIPLINA, ID_PROFESSOR) VALUES(4,2);
INSERT INTO PROFESSOR_DISCIPLINA(ID_DISCIPLINA, ID_PROFESSOR) VALUES(5,1);

-- INSERT ALUNO
INSERT INTO ALUNO(NUM_ALUNO, NOME, DATA_NASCIMENTO, ID_CURSO, RUA, NPORTA, CPOSTAL, TELEFONE, EMAIL, NIF)
VALUES(17512,'PEDRO SILVA',TO_DATE('18/03/1996', 'DD/MM/YYYY'), 9119, 'GEREI',105,'4970-555',933333333,'phvsilva@ipvc.pt',123456789);
INSERT INTO ALUNO(NUM_ALUNO, NOME, DATA_NASCIMENTO, ID_CURSO, RUA, NPORTA, CPOSTAL, TELEFONE, EMAIL, NIF)
VALUES(17485,'DIOGO CORREIA',TO_DATE('21/07/1998', 'DD/MM/YYYY'), 5141, 'ZINDE',10,'4970-441',933543768,'diogo@ipvc.pt',635643587);
INSERT INTO ALUNO(NUM_ALUNO, NOME, DATA_NASCIMENTO, ID_CURSO, RUA, NPORTA, CPOSTAL, TELEFONE, EMAIL, NIF)
VALUES(6875,'RITA BRANCO',TO_DATE('18/05/1987', 'DD/MM/YYYY'), 9147, 'AVENIDA FIXE',132,'4970-555',961345765,'rita@ipvc.pt',654321987);
INSERT INTO ALUNO(NUM_ALUNO, NOME, DATA_NASCIMENTO, ID_CURSO, RUA, NPORTA, CPOSTAL, TELEFONE, EMAIL, NIF)
VALUES(342,'PAULO LOPES',TO_DATE('02/01/1986', 'DD/MM/YYYY'), 67, 'RUA DA CIDADE',46,'4900-357',933456743,'paulo@ipvc.pt',456789321);

-- INSERT SESSAO
INSERT INTO SESSAO(NUM_SESSAO, DATA, HORA_INICIO, HORA_FIM, ID_DISCIPLINA, ID_PROFESSOR, ID_SALA)
VALUES(1,TO_DATE('13/12/2018','DD/MM/YYYY'),'10H00','12H00',2,1,6);
INSERT INTO SESSAO(NUM_SESSAO, DATA, HORA_INICIO, HORA_FIM, ID_DISCIPLINA, ID_PROFESSOR, ID_SALA)
VALUES(2,SYSDATE,'14H00','16H00',3,2,1);

-- INSERT ALUNO_SESSAO
INSERT INTO ALUNO_SESSAO(NUM_ALUNO, NUM_SESSAO) VALUES(17512, 1);
INSERT INTO ALUNO_SESSAO(NUM_ALUNO, NUM_SESSAO) VALUES(17512, 2);
INSERT INTO ALUNO_SESSAO(NUM_ALUNO, NUM_SESSAO) VALUES(17485, 1);
INSERT INTO ALUNO_SESSAO(NUM_ALUNO, NUM_SESSAO) VALUES(17485, 2);
INSERT INTO ALUNO_SESSAO(NUM_ALUNO, NUM_SESSAO) VALUES(6875, 1);
INSERT INTO ALUNO_SESSAO(NUM_ALUNO, NUM_SESSAO) VALUES(342, 1);

SELECT A.NOME, C.NOME, S.NUM_SESSAO, S.DATA, D.SIGLA, D.DESCRICAO
FROM ALUNO A, ALUNO_SESSAO A_S, CURSO C, SESSAO S, DISCIPLINA D
WHERE C.ID_CURSO = A.ID_CURSO AND A.NUM_ALUNO = A_S.NUM_ALUNO 
AND A_S.NUM_SESSAO = S.NUM_SESSAO AND S.ID_DISCIPLINA = D.ID_DISCIPLINA
ORDER BY A.NUM_ALUNO;
